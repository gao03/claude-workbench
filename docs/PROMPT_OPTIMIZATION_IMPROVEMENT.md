# 提示词优化系统提示词改进说明

## 🎯 问题分析

### 用户反馈的问题
使用 Gemini 2.5 Pro 优化后的提示词感觉"怪怪的"，例如：
- 原始提示词可能只是想问一个技术问题
- 优化后变成了"请你扮演一名资深的软件架构师和产品经理，基于刚刚生成的 **CC Switch 项目深度分析报告**..."
- 完全改变了用户的原始意图

### 根本原因
**系统提示词不够精确**，没有明确告诉 AI：
1. ❌ 这是在编程/开发环境中
2. ❌ 用户正在与 Claude Code 对话
3. ❌ 应该保持用户的原始意图
4. ❌ 不要添加角色扮演等无关内容

---

## 📊 对比分析

### ❌ 改进前的系统提示词

```
你是一个专业的提示词优化助手。请优化用户的提示词，使其：
1. 更清晰、更具体
2. 包含必要的上下文信息
3. 结构化表达需求
4. 避免歧义

当前对话上下文：
[上下文内容]

请直接返回优化后的提示词，不要添加解释。
```

**问题点：**
- 🔴 太泛化，没有说明使用场景
- 🔴 没有强调保持原始意图
- 🔴 可能导致 AI 过度发挥
- 🔴 容易添加角色扮演等不必要内容

### ✅ 改进后的系统提示词

```
你是一个专业的提示词优化助手，专门为 Claude Code 编程助手优化用户的提示词。

【优化目标】
1. 保持用户的原始意图和核心需求不变
2. 使提示词更清晰、更具体、更结构化
3. 基于对话上下文补充必要的技术细节
4. 使用准确的技术术语，避免歧义

【优化原则】
- ✅ 保持技术性和实用性
- ✅ 只优化表达方式，不改变核心需求
- ✅ 如果用户的意图已经很明确，只需微调即可
- ❌ 不要添加角色扮演（如"请你扮演..."）
- ❌ 不要添加过多的礼貌用语或客套话
- ❌ 不要改变用户的问题类型（如把技术问题改成分析报告）
- ❌ 不要添加用户没有要求的额外任务

【当前对话上下文】
[上下文内容]

【输出要求】
直接返回优化后的提示词，不要添加任何解释、评论或元信息。
```

**改进点：**
- 🟢 明确说明这是为 Claude Code 优化
- 🟢 强调保持原始意图
- 🟢 列出明确的"不要做"列表
- 🟢 强调技术性和实用性

---

## 🔍 实际效果对比

### 场景 1：简单技术问题

**原始提示词：**
```
帮我看看这个函数有什么问题
```

**改进前可能的输出：**
```
请你扮演一名资深的软件工程师，深入分析以下函数的潜在问题，
包括但不限于代码质量、性能优化、安全隐患、可维护性等多个维度，
并提供详细的改进建议和最佳实践。
```
❌ 添加了角色扮演和不必要的任务

**改进后的输出：**
```
请检查这个函数的代码问题，包括逻辑错误、性能问题和潜在 bug。
```
✅ 保持原意，只是更清晰

---

### 场景 2：已经很清晰的提示词

**原始提示词：**
```
实现一个 React 组件，用于显示用户列表，支持搜索和分页。
```

**改进前可能的输出：**
```
请你扮演一名资深的前端架构师，为我设计并实现一个高性能、可扩展的 React 用户列表组件。
该组件需要具备以下核心功能：
1. 完整的用户数据展示
2. 实时搜索过滤功能
3. 分页导航机制
4. 响应式设计支持
5. 单元测试覆盖
...（省略更多不必要的内容）
```
❌ 过度发挥，添加了用户没要求的内容

**改进后的输出：**
```
实现一个 React 用户列表组件，需要包含以下功能：
1. 展示用户列表数据
2. 支持关键词搜索过滤
3. 实现分页功能

请使用 TypeScript 和 React Hooks。
```
✅ 保持原意，补充必要的技术细节

---

### 场景 3：有上下文的对话

**对话上下文：**
```
用户: 我正在开发一个登录功能
助手: 我帮你实现了基本的登录表单
用户: [想优化提示词] 增加密码强度验证
```

**改进前可能的输出：**
```
请你基于当前的登录功能开发场景，全面评估并实现一个企业级的密码强度验证系统，
包括但不限于：复杂度检测、常见密码黑名单、实时反馈机制、国际化支持等...
```
❌ 把简单需求变成了复杂的分析任务

**改进后的输出：**
```
在现有登录表单中添加密码强度验证功能：
1. 检测密码长度（最少8位）
2. 要求包含大小写字母、数字和特殊字符
3. 实时显示密码强度提示
```
✅ 基于上下文，明确具体需求

---

## 🎯 优化效果

### 预期改进

| 方面 | 改进前 | 改进后 |
|-----|--------|--------|
| 保持原意 | ⚠️ 经常改变 | ✅ 始终保持 |
| 角色扮演 | ⚠️ 经常添加 | ✅ 不再添加 |
| 任务范围 | ⚠️ 经常扩大 | ✅ 控制合理 |
| 技术准确性 | 🟡 一般 | ✅ 显著提升 |
| 实用性 | 🟡 过于理想化 | ✅ 更加实用 |

### 适用场景

✅ **应该使用优化功能的场景：**
- 提示词模糊、不够具体
- 缺少必要的技术细节
- 表达不够清晰
- 想基于上下文补充信息

❌ **不需要使用优化的场景：**
- 提示词已经非常清晰明确
- 简单的问答（如"这是什么？"）
- 需要保持原始表达风格

---

## 🔧 技术实现

### 修改的文件

1. **`src/lib/promptEnhancementService.ts`**
   - 第三方 API（OpenAI、Deepseek 等）的系统提示词

2. **`src-tauri/src/commands/claude.rs`**
   - `enhance_prompt()` - 本地 Claude Code CLI 的系统提示词
   - `enhance_prompt_with_gemini()` - Gemini CLI 的系统提示词

### 代码位置

```typescript
// src/lib/promptEnhancementService.ts (第266-286行)
export async function callEnhancementAPI(
  provider: PromptEnhancementProvider,
  prompt: string,
  context?: string[]
): Promise<string> {
  const systemPrompt = `你是一个专业的提示词优化助手，专门为 Claude Code 编程助手优化用户的提示词。

【优化目标】
1. 保持用户的原始意图和核心需求不变
...
```

```rust
// src-tauri/src/commands/claude.rs (第2822-2847行)
let enhancement_request = format!(
    "You are a professional prompt optimization assistant, specializing in optimizing user prompts for Claude Code programming assistant.\n\
    \n\
    【Optimization Goals】\n\
    1. Maintain the user's original intent and core requirements\n\
    ...
```

---

## 📝 使用建议

### 1. 优化提示词的最佳时机

**✅ 推荐使用：**
- 开始一个新任务，但不确定如何准确描述
- 提示词写得比较简略，想补充细节
- 多次对话后，想根据上下文优化下一个问题

**❌ 不推荐使用：**
- 提示词已经非常具体和清晰
- 简单的一句话问题
- 需要保持特定的语气或风格

### 2. 检查优化结果

优化后请检查：
- ✅ 是否保持了你的原始意图？
- ✅ 是否添加了不必要的角色扮演？
- ✅ 是否把简单问题复杂化了？
- ✅ 是否添加了你没要求的额外任务？

**如果发现问题：**
1. 直接修改优化后的文本
2. 或者不使用优化，保持原始提示词

### 3. 充分利用上下文配置

参考 [提示词上下文配置文档](./PROMPT_CONTEXT_CONFIG.md)：
- 简单任务：使用**精简模式**（减少上下文）
- 复杂任务：使用**详细模式**（完整上下文）
- 一般任务：使用**平衡模式**（推荐）

---

## 🎨 最佳实践

### 编写提示词的建议

即使使用优化功能，也建议：

1. **明确目标** - 说清楚你想做什么
2. **提供上下文** - 如果需要，简要说明当前状态
3. **具体要求** - 列出具体的需求点
4. **技术细节** - 提到使用的技术栈

**示例：**
```
原始：帮我写个登录功能
改进：实现一个用户登录功能，使用 React + TypeScript，
      包含用户名/密码输入、表单验证和错误提示
```

这样即使不使用优化功能，也能得到好的结果。

---

## ❓ 常见问题

### Q1: 为什么优化后的提示词还是感觉怪？

**可能原因：**
1. AI 模型本身的理解偏差
2. 上下文信息不够或太多
3. 原始提示词过于模糊

**解决方法：**
1. 调整[上下文配置](./PROMPT_CONTEXT_CONFIG.md)
2. 手动修改优化后的文本
3. 原始提示词写得更具体一些

### Q2: 不同 AI 模型优化效果一样吗？

**不一样。** 不同模型对系统提示词的理解和遵循度不同：
- **GPT-4** - 遵循度高，效果稳定
- **Claude** - 理解能力强，较少添加无关内容
- **Gemini** - 有时会过度发挥
- **Deepseek** - 成本低，基本能满足需求
- **通义千问** - 理解中文很好，但有时过于正式

**建议：** 测试不同模型，选择最适合你的。

### Q3: 可以自定义系统提示词吗？

**目前不支持。** 但这是一个很好的建议，可以在未来版本中添加：
- 允许用户自定义系统提示词
- 保存多个系统提示词模板
- 针对不同场景使用不同模板

### Q4: 系统提示词会消耗额外的 token 吗？

**是的。** 系统提示词会作为 input tokens 发送给 API：
- 改进前：约 100 tokens
- 改进后：约 300 tokens
- 加上上下文：可能 500-2000 tokens

但这个成本是必要的，能显著提高优化质量。

---

## 🔄 更新日志

### v1.1.0 (当前版本)
- ✨ 优化系统提示词，强调保持原始意图
- ✅ 添加明确的"不要做"列表
- ✅ 强调技术性和实用性
- ✅ 统一所有三种优化方式的提示词
- 📝 创建详细的对比文档

### v1.0.0
- ✨ 初始版本
- 基础的提示词优化功能

---

## 📧 反馈

如果优化后的提示词还是感觉怪，请：
1. 截图分享原始提示词和优化后的结果
2. 说明使用的 AI 模型
3. 描述期望的优化效果

我们会持续改进系统提示词，让优化功能更好用！

---

**相关文档：**
- [提示词上下文配置](./PROMPT_CONTEXT_CONFIG.md)
- [项目 README](../README.md)


