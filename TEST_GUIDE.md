# ğŸ§ª Bug ä¿®å¤æµ‹è¯•æŒ‡å—

## å¿«é€Ÿæµ‹è¯•ï¼ˆ3 åˆ†é’Ÿï¼‰

### âœ… æµ‹è¯• 1ï¼šæç¤ºè¯ä¼˜åŒ–æ’¤é”€åŠŸèƒ½

**æ­¥éª¤**:
1. å¯åŠ¨åº”ç”¨ï¼š`npm run tauri:dev`
2. æ‰“å¼€ä»»æ„ä¼šè¯
3. è¾“å…¥æµ‹è¯•æ–‡æœ¬ï¼š`å¸®æˆ‘å†™ä¸€ä¸ª Python å‡½æ•°`
4. ç‚¹å‡»"ä¼˜åŒ–æç¤ºè¯"æŒ‰é’®ï¼ˆâš¡ å›¾æ ‡ï¼‰
5. ç­‰å¾…ä¼˜åŒ–å®Œæˆï¼ˆæ–‡æœ¬ä¼šå˜é•¿ï¼‰
6. **ç«‹å³æŒ‰ `Ctrl+Z`**

**é¢„æœŸç»“æœ**:
- âœ… æ–‡æœ¬æ¢å¤åˆ°åŸå§‹å†…å®¹ï¼š`å¸®æˆ‘å†™ä¸€ä¸ª Python å‡½æ•°`
- âœ… æŒ‰ `Ctrl+Y` å¯ä»¥é‡åš
- âœ… å¯ä»¥ç»§ç»­æ’¤é”€ä¹‹å‰çš„ç¼–è¾‘æ“ä½œ

**å¦‚æœå¤±è´¥**: æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ `execCommand` ç›¸å…³é”™è¯¯

---

### âœ… æµ‹è¯• 2ï¼šä»Šæ—¥ç»Ÿè®¡æ—¶åŒºå‡†ç¡®æ€§

**æ­¥éª¤**:
1. æ‰“å¼€"ç»Ÿè®¡"æ ‡ç­¾é¡µ
2. é€‰æ‹©"ä»Šæ—¥"
3. è®°å½•æ˜¾ç¤ºçš„æˆæœ¬å’Œ Token æ•°æ®
4. æ‰“å¼€ JSONL æ–‡ä»¶éªŒè¯ï¼ˆè§ä¸‹æ–¹è·¯å¾„ï¼‰

**JSONL æ–‡ä»¶ä½ç½®**:
```
Windows: C:\Users\{ç”¨æˆ·å}\.claude\projects\{é¡¹ç›®ID}\{ä¼šè¯ID}.jsonl
macOS: ~/.claude/projects/{é¡¹ç›®ID}/{ä¼šè¯ID}.jsonl
Linux: ~/.claude/projects/{é¡¹ç›®ID}/{ä¼šè¯ID}.jsonl
```

**éªŒè¯æ–¹æ³•**:
```bash
# æ‰¾åˆ°ä»Šå¤©åˆ›å»ºçš„ä¼šè¯æ–‡ä»¶
ls -lt ~/.claude/projects/*/  | head -5

# æŸ¥çœ‹æ–‡ä»¶å†…å®¹
cat ~/.claude/projects/{é¡¹ç›®ID}/{ä¼šè¯ID}.jsonl | grep timestamp
```

**æ‰‹åŠ¨éªŒè¯**:
1. æ‰¾åˆ° timestampï¼Œå¦‚ `"2025-01-01T18:00:00Z"`
2. è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´ï¼ˆGMT+8 â†’ 2025-01-02 02:00:00ï¼‰
3. æ£€æŸ¥ç»Ÿè®¡ä¸­æ˜¯å¦æ˜¾ç¤ºåœ¨ **2025-01-02** çš„æ•°æ®ä¸­

**é¢„æœŸç»“æœ**:
- âœ… å‡Œæ™¨ 0-8 ç‚¹çš„æ•°æ®æ˜¾ç¤ºåœ¨ä»Šå¤©ï¼ˆè€Œéæ˜¨å¤©ï¼‰
- âœ… "ä»Šæ—¥"æ•°æ®æ€»é‡åˆç†
- âœ… æ—¥æœŸåˆ†ç»„å‡†ç¡®

---

## æ·±åº¦æµ‹è¯•ï¼ˆå¯é€‰ï¼‰

### æµ‹è¯• 3ï¼šè·¨æ—¶åŒºæ•°æ®éªŒè¯

#### å‡†å¤‡æµ‹è¯•æ•°æ®

1. æ‰‹åŠ¨ç¼–è¾‘ JSONL æ–‡ä»¶ï¼Œæ·»åŠ æµ‹è¯•è®°å½•ï¼š

```json
{"timestamp":"2025-01-01T16:00:00Z","message":{"model":"claude-sonnet-4-5","usage":{"input_tokens":100,"output_tokens":200}},"costUSD":0.01}
{"timestamp":"2025-01-01T18:00:00Z","message":{"model":"claude-sonnet-4-5","usage":{"input_tokens":100,"output_tokens":200}},"costUSD":0.01}
{"timestamp":"2025-01-02T02:00:00Z","message":{"model":"claude-sonnet-4-5","usage":{"input_tokens":100,"output_tokens":200}},"costUSD":0.01}
```

2. é‡å¯åº”ç”¨
3. æ‰“å¼€ç»Ÿè®¡ï¼Œé€‰æ‹©"ä»Šæ—¥"ï¼ˆå‡è®¾ä»Šå¤©æ˜¯ 2025-01-02ï¼‰

#### é¢„æœŸç»“æœï¼ˆGMT+8ï¼‰

| UTC Timestamp | æœ¬åœ°æ—¶é—´ | åº”æ˜¾ç¤ºåœ¨ | ä¿®å¤å‰ | ä¿®å¤å |
|--------------|---------|---------|--------|--------|
| 2025-01-01T16:00:00Z | 2025-01-02 00:00 | ä»Šæ—¥ | âŒ æ˜¨å¤© | âœ… ä»Šæ—¥ |
| 2025-01-01T18:00:00Z | 2025-01-02 02:00 | ä»Šæ—¥ | âŒ æ˜¨å¤© | âœ… ä»Šæ—¥ |
| 2025-01-02T02:00:00Z | 2025-01-02 10:00 | ä»Šæ—¥ | âœ… ä»Šæ—¥ | âœ… ä»Šæ—¥ |

---

### æµ‹è¯• 4ï¼šæ•°æ®åº“æ€§èƒ½éªŒè¯

#### æ­¥éª¤
1. æ‰“å¼€"Storage"æ ‡ç­¾é¡µï¼ˆè®¾ç½® â†’ Storageï¼‰
2. æ‰§è¡Œ SQL æŸ¥è¯¢ï¼š

```sql
-- æ£€æŸ¥ WAL æ¨¡å¼
PRAGMA journal_mode;
-- åº”è¿”å›: WAL

-- æ£€æŸ¥ç´¢å¼•
SELECT name, tbl_name FROM sqlite_master WHERE type='index' AND name LIKE 'idx_usage%';
-- åº”æ˜¾ç¤º 6 ä¸ªç´¢å¼•

-- åˆ†ææŸ¥è¯¢è®¡åˆ’
EXPLAIN QUERY PLAN SELECT * FROM usage_entries WHERE session_id = 'test';
-- åº”æ˜¾ç¤º: SEARCH ... USING INDEX idx_usage_session_id
```

#### é¢„æœŸç»“æœ
- âœ… WAL æ¨¡å¼å·²å¯ç”¨
- âœ… 6 ä¸ª `idx_usage_*` ç´¢å¼•å­˜åœ¨
- âœ… æŸ¥è¯¢ä½¿ç”¨ç´¢å¼•ï¼ˆä¸æ˜¯å…¨è¡¨æ‰«æï¼‰

---

## ğŸ¯ å®Œæ•´æµ‹è¯•æµç¨‹

### 1. ç¼–è¯‘æµ‹è¯•
```bash
# Rust ç¼–è¯‘
cd src-tauri
cargo check
# é¢„æœŸ: âœ… Finished in ~3s

# å‰ç«¯ç¼–è¯‘
cd ..
npm run build
# é¢„æœŸ: âœ… built in ~4s
```

### 2. å¯åŠ¨æµ‹è¯•
```bash
npm run tauri:dev
# é¢„æœŸ: âœ… åº”ç”¨æ­£å¸¸å¯åŠ¨ï¼Œæ—  panic
```

### 3. åŠŸèƒ½æµ‹è¯•
- [ ] æç¤ºè¯ä¼˜åŒ–æ’¤é”€åŠŸèƒ½
- [ ] ä»Šæ—¥ç»Ÿè®¡æ•°æ®å‡†ç¡®æ€§
- [ ] æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–ç”Ÿæ•ˆ

---

## ğŸ› å·²çŸ¥é™åˆ¶

### æç¤ºè¯æ’¤é”€
- `document.execCommand` å·²è¢«æ ‡è®°ä¸ºåºŸå¼ƒ
- ä½†æ‰€æœ‰ç°ä»£æµè§ˆå™¨ä»æ”¯æŒ
- æœªæ¥å¯èƒ½éœ€è¦è¿ç§»åˆ°æ–°çš„ Input Events API

### æ—¶åŒºå¤„ç†
- å‡è®¾ç³»ç»Ÿæ—¶åŒºé…ç½®æ­£ç¡®
- ä¾èµ– Rust `chrono` åº“çš„æ—¶åŒºæ£€æµ‹
- Windows ç”¨æˆ·ç¡®ä¿ç³»ç»Ÿæ—¶åŒºè®¾ç½®å‡†ç¡®

---

## ğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•

### æµ‹è¯•ç¯å¢ƒ
- æ•°æ®é‡ï¼š1000 æ¡ usage_entries
- æŸ¥è¯¢ç±»å‹ï¼šæŒ‰ session_id æŸ¥è¯¢

### åŸºå‡†æµ‹è¯•ä»£ç 

```typescript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
const testQuery = async () => {
  const start = performance.now();

  const result = await invoke('storage_read_table', {
    tableName: 'usage_entries',
    page: 1,
    pageSize: 100,
    searchQuery: null
  });

  const end = performance.now();
  console.log(`æŸ¥è¯¢è€—æ—¶: ${(end - start).toFixed(2)} ms`);
  console.log(`è¿”å›è®°å½•æ•°: ${result.rows.length}`);
};

// è¿è¡Œ 5 æ¬¡å–å¹³å‡å€¼
for (let i = 0; i < 5; i++) {
  await testQuery();
}
```

### é¢„æœŸç»“æœ
- âœ… æŸ¥è¯¢è€—æ—¶ < 10msï¼ˆä¼˜åŒ–å‰ ~50msï¼‰
- âœ… æ•°æ®æ­£ç¡®è¿”å›
- âœ… æ— é”™è¯¯æˆ–è­¦å‘Š

---

## â“ å¸¸è§é—®é¢˜

### Q1: æç¤ºè¯ä¼˜åŒ–åæŒ‰ Ctrl+Z æ²¡ååº”ï¼Ÿ
**A**: æ£€æŸ¥æ˜¯å¦åœ¨ç¼–è¾‘å™¨è·å¾—ç„¦ç‚¹æ—¶æŒ‰ä¸‹ã€‚å¦‚æœæ˜¯åœ¨æ‰©å±•æ¨¡å¼ï¼Œç¡®ä¿ç‚¹å‡»äº†ç¼–è¾‘åŒºåŸŸã€‚

### Q2: ç»Ÿè®¡æ•°æ®ä»ç„¶ä¸å‡†ç¡®ï¼Ÿ
**A**:
1. æ£€æŸ¥ç³»ç»Ÿæ—¶åŒºè®¾ç½®æ˜¯å¦æ­£ç¡®
2. æ¸…é™¤ç¼“å­˜é‡æ–°åŠ è½½ï¼š`Ctrl+Shift+R`
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

### Q3: WAL æ¨¡å¼æœªå¯ç”¨ï¼Ÿ
**A**:
1. åˆ é™¤æ•°æ®åº“æ–‡ä»¶ï¼š`%APPDATA%\com.claude.workbench\agents.db`
2. é‡å¯åº”ç”¨ï¼ˆä¼šè‡ªåŠ¨é‡å»ºæ•°æ®åº“ï¼‰

---

## ğŸŠ æµ‹è¯•é€šè¿‡æ ‡å‡†

æ‰€æœ‰ä»¥ä¸‹é¡¹é€šè¿‡å³å¯è®¤ä¸ºä¿®å¤æˆåŠŸï¼š

- [ ] åº”ç”¨æ­£å¸¸å¯åŠ¨ï¼Œæ—  panic
- [ ] æç¤ºè¯ä¼˜åŒ–å¯ä»¥æ’¤é”€
- [ ] ä»Šæ—¥ç»Ÿè®¡æ•°æ®å‡†ç¡®ï¼ˆå‡Œæ™¨æ•°æ®ä¸å½’å…¥æ˜¨å¤©ï¼‰
- [ ] WAL æ¨¡å¼å·²å¯ç”¨
- [ ] 6 ä¸ªç´¢å¼•å·²åˆ›å»º
- [ ] æŸ¥è¯¢é€Ÿåº¦æ˜æ˜¾æå‡

---

**å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†æŠ€æœ¯æ–‡æ¡£**:
- `BUGFIX_REPORT.md` - å®Œæ•´ä¿®å¤æŠ¥å‘Š
- `TIMEZONE_FIX_EXPLAINED.md` - æ—¶åŒºé—®é¢˜æ·±åº¦è§£æ
- `SQLITE_PERFORMANCE_OPTIMIZATION.md` - æ€§èƒ½ä¼˜åŒ–æ–‡æ¡£
